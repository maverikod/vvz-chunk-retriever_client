# Chunk Retriever Client: Техническая спецификация

## Общее описание
В этом документе описывается архитектура, требования и стратегия тестирования асинхронного Python-клиента для микросервиса Chunk Retriever.

## Структура проекта (PyPi-ready)
- Проект должен соответствовать стандартной структуре пакета PyPi:
  - Исходный код в отдельной директории пакета (например, `chunk_retriever_client/`)
  - Каталог `examples/` в корне проекта с реальными примерами использования клиента
  - Каталог `tests/` для юнит- и интеграционных тестов
  - Весь код и примеры должны быть полностью покрыты тестами (включая скрипты из examples)
  - Готовность к упаковке и публикации на PyPi

## Требования к клиенту
- **Входные параметры:**
  - `url`: базовый URL сервера Chunk Retriever
  - `port`: порт сервера
  - `source_id`: строка UUID4
- **Выходные данные:**
  - Кортеж `(response, errstr)`
    - `response`: ответ от ретривера (распарсенный JSON или raw-текст)
    - `errstr`: описание ошибки (строка) или пустая строка, если ошибки нет. В случае ошибки `response` — `None`.
- **Реализация:**
  - Класс с асинхронным методом (может вызываться без создания экземпляра)
  - 100% покрытие тестами (юнит + интеграция)
  - Клиент должен обрабатывать **все исключительные ситуации**, включая недоступность сервера, таймауты, невалидные ответы и сетевые ошибки.

## Тестирование
- **Юнит-тесты:** покрывают все ветки кода, включая обработку ошибок.
- **Интеграционные тесты:**
  - Используют реальные сервисы:
    - Chunk Retriever: `localhost:8010`
    - SVO Chunker: `localhost:8009`
    - Vector Store DB: `localhost:3007`, `localhost:8007`
  - Сценарий:
    1. Использовать `@chunk_metadata_adapter` для управления метаданными.
    2. Использовать `@svo_client` для получения чанков от чанкера.
    3. Использовать `@vector_store_client` для записи/чтения чанков в/из баз.
    4. Сделать запрос к ретриверу и проверить, что ответ соответствует ожидаемым чанкам в базах.
- **Тесты примеров:**
  - Для всех скриптов из каталога `examples/` должны быть написаны тесты, проверяющие их корректную работу с указанными серверами.

## Зависимости
- `@chunk_metadata_adapter` — менеджер метаданных
- `@svo_client` — клиент чанкера
- `@vector_store_client` — клиент базы векторных представлений

## Пример использования
```python
response, errstr = await ChunkRetrieverClient.find_chunks_by_source_id(
    url="http://localhost", port=8010, source_id="b7e2c4a0-1234-4f56-8abc-1234567890ab"
)
```

## Обработка ошибок
- Если `source_id` не валидный UUID4 — вернуть строку ошибки.
- Если ошибка сети или сервера — вернуть строку ошибки и `None` как ответ.
- Если ответ невалидный JSON — вернуть строку ошибки и `None` как ответ.
- Все исключения (включая недоступность сервера, таймауты и т.д.) должны обрабатываться корректно и возвращаться через `errstr`.

## Структура файлов
- `chunk_retriever_client/` — реализация клиента (PyPi-пакет)
- `examples/` — реальные примеры использования
- `tests/` — юнит- и интеграционные тесты (включая тесты для примеров)
- Документация на английском (`docs/tech_spec.md`) и русском (`docs/chunk_metadata_adapter/ru/tech_spec.ru.md`) 